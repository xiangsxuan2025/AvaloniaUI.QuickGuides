<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:vm="using:BindingConvertersExample.ViewModels"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:converters="clr-namespace:BindingConvertersExample.Converters"
		mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
		x:Class="BindingConvertersExample.Views.MainWindow"
		x:DataType="vm:MainWindowViewModel"
		Icon="/Assets/avalonia-logo.ico"
		Title="BindingsAndConverters">
	<Window.Resources>
		<!--
		为什么Converters写在Window.Resources里面?
		这样，窗口内的所有控件, 都可以通过{StaticResource ResourceKey}来引用这些转换器。

		最佳实践建议
		单个窗口 使用 → Window.Resources
		整个应用 使用 → Application.Resources, 如：BooleanToVisibilityConverter 这种很通用的转换器
		特定用户控件 使用 → UserControl.Resources
		局部 使用 → 最近容器的Resources
		-->
		<converters:BirthdateToAgeConverter x:Key="BirthdateToAgeConverter"/>
		<converters:AgeToPluralConverter x:Key="AgeToPluralConverter"/>
	</Window.Resources>
	<Design.DataContext>
		<!-- This only sets the DataContext for the previewer in an IDE,
		to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
		<vm:MainWindowViewModel />
	</Design.DataContext>

	<Panel VerticalAlignment="Center" HorizontalAlignment="Center">
		<StackPanel Spacing="10">
			<TextBlock FontWeight="Bold">Enter your date of birth here.</TextBlock>
			<DatePicker SelectedDate="{Binding Age, Converter={StaticResource BirthdateToAgeConverter}, Mode=OneWayToSource}"/>
			<!--
			为什么Converter用StaticResource?
			1. 性能优化
			StaticResource在XAML加载时一次性解析并缓存：
			xml
			<- 只在加载时查找一次，后续使用缓存的值 ->
			<Run Text="{Binding Age, Converter={StaticResource AgeToPluralConverter}}"/>
			对比DynamicResource（运行时动态查找）：
			xml
			<- 每次都会重新查找，性能开销大 ->
			<Run Text="{Binding Age, Converter={DynamicResource AgeToPluralConverter}}"/>

			2. Converter的特性决定
			Converter通常是：
			无状态的 - 不依赖运行时数据
			线程安全的 - 可在多个绑定间共享
			单例式的 - 一个实例足够处理所有转换

			3. 什么时候用DynamicResource
			只有在资源可能在运行时改变时才用DynamicResource：

			4. 如果误用DynamicResource
			xml
			<- 不推荐：不必要的性能开销 ->
			<TextBlock Text="{Binding Age, Converter={DynamicResource AgeToPluralConverter}}"/>
			这会导致：
			每次绑定更新时都重新查找资源
			额外的性能开销
			没有实际好处（因为Converter不会在运行时改变）

			5. 最佳实践总结
			资源类型	使用场景	性能
			StaticResource	Converter、样式、静态数据	✅ 高效
			DynamicResource	主题、本地化、运行时变化的资源	⚠️ 根据需要

			6. 什么时候会销毁呢?
			1. 不同作用域的销毁时机
			Window.Resources 中的 Converter
			xml
			<Window.Resources>
			<converters:AgeToPluralConverter x:Key="AgeToPluralConverter"/>
			</Window.Resources>
			销毁时机：当窗口关闭时

			窗口关闭 → 所有窗口资源被释放 → Converter被垃圾回收

			Application.Resources 中的 Converter
			xml
			<Application.Resources>
			<converters:GlobalConverter x:Key="GlobalConverter"/>
			</Application.Resources>
			销毁时机：当应用程序退出时

			应用退出 → 应用资源被释放 → Converter被垃圾回收

			UserControl.Resources 中的 Converter
			xml
			<UserControl.Resources>
			<converters:LocalConverter x:Key="LocalConverter"/>
			</UserControl.Resources>
			销毁时机：当UserControl被从视觉树移除且没有引用时
			-->
			<TextBlock>
				<Run>Your age is </Run>
				<Run Text="{Binding Age}"/>
				<Run>year</Run><Run Text="{Binding Age, Converter={StaticResource AgeToPluralConverter}, Mode=OneWay}"/>
				<Run>old today.</Run>
			</TextBlock>
		</StackPanel>
	</Panel>

</Window>